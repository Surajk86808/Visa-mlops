<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>US Visa Prediction</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 20px auto;
      }
      form {
        display: grid;
        grid-template-columns: repeat(2, minmax(250px, 1fr));
        gap: 12px 20px;
      }
      label {
        display: flex;
        flex-direction: column;
        font-size: 14px;
      }
      input,
      select {
        padding: 8px;
        font-size: 14px;
      }
      .row {
        grid-column: 1 / -1;
      }
      button {
        padding: 10px 16px;
        font-size: 14px;
        cursor: pointer;
      }
      pre {
        background: #f6f8fa;
        padding: 12px;
        border: 1px solid #e1e4e8;
      }
    </style>
  </head>
  <body>
    <h1>US Visa Prediction</h1>
    <p>Fill the form and get prediction. You can also trigger training.</p>

    <section>
      <h2>Predict</h2>
      <form id="predict-form">
        <label
          >continent<input name="continent" required placeholder="e.g., Asia"
        /></label>
        <label
          >education_of_employee<input
            name="education_of_employee"
            required
            placeholder="e.g., Masters"
        /></label>
        <label
          >has_job_experience<select name="has_job_experience">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select></label
        >
        <label
          >requires_job_training<select name="requires_job_training">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select></label
        >
        <label
          >no_of_employees<input
            name="no_of_employees"
            type="number"
            required
            value="100"
        /></label>
        <label
          >yr_of_estab<input
            name="yr_of_estab"
            type="number"
            required
            value="2005"
        /></label>
        <label
          >region_of_employment<input
            name="region_of_employment"
            required
            placeholder="e.g., Northeast"
        /></label>
        <label
          >prevailing_wage<input
            name="prevailing_wage"
            type="number"
            required
            value="60000"
        /></label>
        <label
          >unit_of_wage<input
            name="unit_of_wage"
            required
            placeholder="e.g., Year"
        /></label>
        <label
          >full_time_position<select name="full_time_position">
            <option value="Y">Y</option>
            <option value="N">N</option>
          </select></label
        >
        <div class="row"><button type="submit">Predict</button></div>
      </form>
      <h3>Result</h3>
      <pre id="predict-result">Waiting...</pre>
    </section>

    <section>
      <h2>Train</h2>
      <button id="train-btn">Run Training Pipeline</button>
      <pre id="train-result">Waiting...</pre>
    </section>

    <script>
      const byName = (form, name) =>
        form.querySelector(`[name="${name}"]`).value;

      document
        .getElementById("predict-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const f = e.target;
          const payload = {
            items: [
              {
                continent: byName(f, "continent"),
                education_of_employee: byName(f, "education_of_employee"),
                has_job_experience: byName(f, "has_job_experience"),
                requires_job_training: byName(f, "requires_job_training"),
                no_of_employees: parseInt(byName(f, "no_of_employees")),
                yr_of_estab: parseInt(byName(f, "yr_of_estab")),
                region_of_employment: byName(f, "region_of_employment"),
                prevailing_wage: parseInt(byName(f, "prevailing_wage")),
                unit_of_wage: byName(f, "unit_of_wage"),
                full_time_position: byName(f, "full_time_position"),
              },
            ],
          };
          try {
            const res = await fetch("/predict", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            const json = await res.json();
            document.getElementById("predict-result").textContent =
              JSON.stringify(json, null, 2);
          } catch (err) {
            document.getElementById("predict-result").textContent =
              "Error: " + err.message;
          }
        });

      document
        .getElementById("train-btn")
        .addEventListener("click", async () => {
          document.getElementById("train-result").textContent =
            "Starting training...";
          try {
            const res = await fetch("/train", { method: "POST" });
            const json = await res.json();
            document.getElementById("train-result").textContent =
              JSON.stringify(json, null, 2);
          } catch (err) {
            document.getElementById("train-result").textContent =
              "Error: " + err.message;
          }
        });
    </script>
  </body>
</html>
